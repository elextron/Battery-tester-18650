<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>18650 Battery Tester</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            align-items: center;
            background-color: #1E1E2F;
            color: #FFFFFF;
            display: flex;
            flex-direction: column;
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
        }
        h1 {
        	text-align: center;
            color: #4CAFED;
        }
        
        h2 {
        	text-align: center;
        	color: #4CAFED;
        }
        
        h3 {
        	color: #4CAFED;
        }
        
        .container {
            background-color: #2A2A3B;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            max-width: 1140px;
            min-width: 1200px;
            padding: 50px;
            width: 90%;
        }
        .card {
            background-color: #2E2E3F;
            border: 1px solid #5b5b99;
            border-radius: 5px;
            padding: 15px;
        }
        .cell {
        	align-items: center;
            background-color: #2E2E3F;
            border: 0px solid #5b5b99;
            border-radius: 10px;
            padding: 2px;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
        }
        button {
            background-color: #4CAFED;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            padding: 10px;
        }
        button:hover {
            background-color: #4b58c7;
        }
        input[type="text"] {
            background-color: #2E2E3F;
            border: 1px solid #4CAFED;
            border-radius: 8px;
            color: #FFFFFF;
            padding: 8px;
            width: calc(100% - 20px);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
            gap: 50px;
            padding: 50px;
        }

		 .gridField {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 80px;
        }
        
        .gridButton {
        	align-items: center;
            display: grid;
            grid-template-columns: auto auto auto auto auto;
            gap: 10px;
            width: 100%;
        }
        
        .gridTop {
        	align-items: center;
            display: grid;
            grid-template-columns: 250px auto auto 200px;
            gap: 10px;
            width: 100%;
        }
        
        
        .gridButtons {
        	background-color: #2A2A3B;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(420px, 1fr));
            gap: 80px;
        }
        
        .slider-container {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .slider-container label {
            color: #FFFFFF;
            font-size: 1.2em;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        /* Hide default checkbox */
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* Slider styles */
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4b58c7; /* Blue when off */
            transition: 0.4s;
            border-radius: 26px;
        }

        /* Knob inside the slider */
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        /* Green when the slider is checked */
        input:checked + .slider {
            background-color: #4CAF50;
        }

        /* Move the knob when checked */
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        
        .activate-relay {
            background-color: #4CAFED;
            color: white;
            border: none;
            border-radius: 250px;
            cursor: pointer;
            padding: 45px;
            font-size: 18px;
            margin-bottom: 30px;
            width: 100%;
        }

        button {
            background-color: #4CAFED;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            padding: 10px;
            margin: 5px 0;
            width: 100%;
        }
        
        buttonSmall {
            background-color: #4CAFED;
            color: white;
            border: none;
            border-radius: 100px;
            cursor: pointer;
            padding: 10px;
            margin: 5px 0;
            width: 100%;
        }

        button:hover, buttonSmall:hover {
            background-color: #277db3;
        }     

        .single-test {
            margin-top: 20px;
            margin-bottom: 20px;
        }
    </style>
    <script>
        let activeCells = [false, false, false, false];
        let Voltages = [
            [3.71, 3.65, 3.72],
            [3.68, 3.60, 3.75],
            [3.69, 3.64, 3.70],
            [3.67, 3.61, 3.74]
        ];
		
        // Boolean variable to store state
        let EN = false;

        // Function to update state and style
        function toggleSlider() {
            const slider = document.getElementById("enableSlider");
            EN = slider.checked; // Update the state
            console.log("Relay enabled:", EN);
        }

        // Function to initialize the slider state
        function initializeSlider() {
            const slider = document.getElementById("enableSlider");
            slider.checked = EN; // Set initial state
        }

        // Initialize the slider when the page loads
        window.onload = initializeSlider;
        
        function activateRelay(cell) {
            activeCells[cell] = !activeCells[cell];
            const cellText = document.getElementById(`cellText${cell + 1}`);
            cellText.style.color = activeCells[cell] ? '#4CAFED' : '#FFFFFF';
            console.log(`Relay ${cell + 1} ${activeCells[cell] ? 'activated' : 'deactivated'}`);
        }

        function connectDCLoad() {
            console.log("DC Load connected and initialized");
        }

        function fullSingleTest(relay) {
            console.log(`Full Single Test for Relay ${relay}`);
        }

        function fullSweep() {
            console.log("Full Sweep initiated");
        }

        function renderVoltageCards() {
            const grid = document.getElementById("grid");
            grid.innerHTML = ""; // Clear current content
            for (let relay = 0; relay < Voltages.length; relay++) {
                const card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `
                    <h3>Cell ${relay + 1}</h3>
                    <div class="voltage-row">
                        <span>Nominal Voltage:</span> <span>${Voltages[relay][0].toFixed(2)} V</span>
                    </div>
                    <div class="voltage-row">
                        <span>Max Discharge Voltage:</span> <span>${Voltages[relay][1].toFixed(2)} V</span>
                    </div>
                    <div class="voltage-row">
                        <span>Max Burst Voltage:</span> <span>${Voltages[relay][2].toFixed(2)} V</span>
                    </div>
                `;
                grid.appendChild(card);
            }
        }

        function saveGlobalSettings() {
            console.log("Global Settings saved");
        }

		
        function singleTest(cellIndex, testMode) {
            console.log(`Single Test for Cell ${cellIndex}, Mode: ${testMode}`);
        }

        function toggleSlider() {
            const slider = document.getElementById("enableSlider");
            slider.parentNode.querySelector('.slider').style.backgroundColor = slider.checked ? "#4b58c7" : "#4CAFED";
        }

        function updateVoltages() {
            Voltages = Voltages.map(volts => volts.map(v => v + (Math.random() - 0.5) * 0.01));
            renderVoltageCards();
        }

		function renderRelays() {
    		const relayGrid = document.getElementById("relayGrid");
    		relayGrid.innerHTML = ""; // Clear existing content

    		Voltages.forEach((volts, relay) => {
        		const relayDiv = document.createElement("div");
        		relayDiv.className = "cell";

        		// Construct the voltage rows
        		const voltageRows = volts.map((voltage, index) => {
            		const labels = ["Nominal Voltage", "Max Discharge Voltage", "Max Burst Voltage"];
            		return `
                		<div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                    		<span style="text-align: left;">${labels[index]}:</span>
                    		<span style="text-align: right;">${voltage.toFixed(2)} V</span>
                		</div>
            		`;
        		}).join("");

        		relayDiv.innerHTML = `
            		<h2 id="cellText${relay + 1}">Cell ${relay + 1}</h2>
            		<button class="activate-relay" onclick="activateRelay(${relay})">Activate Relay</button>
            		<div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between;">
                		<button onclick="fullSingleTest(${relay + 1})">Full Test</button>
                		<button onclick="singleTest(${relay + 1}, document.getElementById('testMode${relay + 1}').value)">Single Test</button>
                		<div class="single-test">
                    		<select id="testMode${relay + 1}">
                        		<option value="0">Nominal</option>
                        		<option value="1">Const DCHG</option>
                        		<option value="2">Burst DCHG</option>
                    		</select>
                		</div>
            		</div>	
            		<div style="margin-top: 15px;">
                		${voltageRows}
            		</div>
        		`;

        		relayGrid.appendChild(relayDiv);
    		});
            

        
}



document.addEventListener("DOMContentLoaded", () => {
    renderRelays();
    renderVoltageCards();
    setInterval(updateVoltages, 1000);   
});

    </script>
</head>
<body>
    <h1>18650 Battery Tester</h1>
    <div class="container">
    
    	<div class='gridTop'>

      		<div class="slider-container">
          		<label for="enableSlider">Enable Relays:</label><br>
       	        <label class="switch">
               	 <input type="checkbox" id="enableSlider" onchange="toggleSlider()">
               	 <span class="slider"></span>
            	</label>
       	 	</div>
		
        	<div>
            </div>
            
            <div>
            </div>
            
        	<div class="cell">
				<h2>DC Load Settings</h2>
				<input type="text" placeholder="DC Load IP Address" id="dcLoadIP" class="dc-load-input">
				<input type="text" placeholder="DC Load Port" id="dcLoadPort" class="dc-load-input">
            	<h1><h1>
            	<h1><h1>
				<button onclick="connectDCLoad()" class="dc-load-button">Connect to DC Load</button>
			</div>        

		</div>
        
        <div id="relayGrid" class="grid">
            <!-- Relays will be rendered dynamically -->
        </div>    
        
		
		<div class='gridButton'>
        
        	<div class='cell'>
            <h1></h1>
            </div>
            
            <div class='cell'>
            <h1></h1>
            </div>
            
        	<div class='buttonSmall'>
        		<button onclick="fullSweep()">Full Sweep</button>
            </div>

		</div>	

			
		
		
		<div class='gridField'>
			<div class="cell">
            	<h2>Global Settings</h2>
				<input type="text" placeholder="Sweep Cell Delay" id="sweepCellDelay">
				<input type="text" placeholder="Test Mode Delay" id="testModeDelay">
				<input type="text" placeholder="Read Volt Offset" id="readVoltOffset">
                <h1><h1>
                <button onclick="saveGlobalSettings()" class="dc-load-button">Save</button>
			</div>
            
            <div class="cell">	
                <h2>Nominal Settings</h2>
				<input type="text" placeholder="Cell Capacity" id="CellCapacity">
                <input type="text" placeholder="Duration (s)" id="duration0"> <!-- ms -->
                <input type="text" placeholder="Discharge (C)" id="discharge0"> <!-- mAh -->
                <h1><h1>
                <button onclick="saveGlobalSettings()" class="dc-load-button">Save</button>             	
            </div>
            
            <div class="cell">	
                <h2>Continious DCHG</h2>
				<input type="text" placeholder="Cell Capacity" id="CellCapacity">
                <input type="text" placeholder="Duration (s)" id="duration1"> <!-- ms -->
                <input type="text" placeholder="Discharge (C)" id="discharge1"> <!-- mAh -->
                <h1><h1>
                <button onclick="saveGlobalSettings()" class="dc-load-button">Save</button>             	
            </div>
            
            <div class="cell">	
                <h2>Burst DCHG</h2>
				<input type="text" placeholder="Cell Capacity" id="CellCapacity">
                <input type="text" placeholder="Duration (s)" id="duration2"> <!-- ms -->
                <input type="text" placeholder="Discharge (C)" id="discharge2"> <!-- mAh -->
                <h1><h1>
                <button onclick="saveGlobalSettings()" class="dc-load-button">Save</button>             	
            </div>
                                


</body>
</html>
